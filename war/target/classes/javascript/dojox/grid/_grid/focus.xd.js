dojo._xdResourceLoaded({depends:[["provide","dojox.grid._grid.focus"]],defineResource:function(A){if(!A._hasResource["dojox.grid._grid.focus"]){A._hasResource["dojox.grid._grid.focus"]=true;
A.provide("dojox.grid._grid.focus");
A.declare("dojox.grid.focus",null,{constructor:function(B){this.grid=B;
this.cell=null;
this.rowIndex=-1;
A.connect(this.grid.domNode,"onfocus",this,"doFocus")
},tabbingOut:false,focusClass:"dojoxGrid-cell-focus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()
},isFocusCell:function(C,B){return(this.cell==C)&&(this.rowIndex==B)
},isLastFocusCell:function(){return(this.rowIndex==this.grid.rowCount-1)&&(this.cell.index==this.grid.layout.cellCount-1)
},isFirstFocusCell:function(){return(this.rowIndex==0)&&(this.cell.index==0)
},isNoFocusCell:function(){return(this.rowIndex<0)||!this.cell
},_focusifyCellNode:function(C){var B=this.cell&&this.cell.getNode(this.rowIndex);
if(B){A.toggleClass(B,this.focusClass,C);
this.scrollIntoView();
try{if(!this.grid.edit.isEditing()){dojox.grid.fire(B,"focus")
}}catch(D){}}},scrollIntoView:function(){if(!this.cell){return 
}var C=this.cell,E=C.view.scrollboxNode,D={w:E.clientWidth,l:E.scrollLeft,t:E.scrollTop,h:E.clientHeight},G=C.getNode(this.rowIndex),F=C.view.getRowNode(this.rowIndex),B=this.grid.scroller.findScrollTop(this.rowIndex);
if(G.offsetLeft+G.offsetWidth>D.l+D.w){E.scrollLeft=G.offsetLeft+G.offsetWidth-D.w
}else{if(G.offsetLeft<D.l){E.scrollLeft=G.offsetLeft
}}if(B+F.offsetHeight>D.t+D.h){this.grid.setScrollTop(B+F.offsetHeight-D.h)
}else{if(B<D.t){this.grid.setScrollTop(B)
}}},styleRow:function(B){if(B.index==this.rowIndex){this._focusifyCellNode(true)
}},setFocusIndex:function(B,C){this.setFocusCell(this.grid.getCell(C),B)
},setFocusCell:function(C,B){if(C&&!this.isFocusCell(C,B)){this.tabbingOut=false;
this.focusGrid();
this._focusifyCellNode(false);
this.cell=C;
this.rowIndex=B;
this._focusifyCellNode(true)
}if(A.isOpera){setTimeout(A.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1)
}else{this.grid.onCellFocus(this.cell,this.rowIndex)
}},next:function(){var E=this.rowIndex,C=this.cell.index+1,B=this.grid.layout.cellCount-1,D=this.grid.rowCount-1;
if(C>B){C=0;
E++
}if(E>D){C=B;
E=D
}this.setFocusIndex(E,C)
},previous:function(){var B=(this.rowIndex||0),C=(this.cell.index||0)-1;
if(C<0){C=this.grid.layout.cellCount-1;
B--
}if(B<0){B=0;
C=0
}this.setFocusIndex(B,C)
},move:function(I,F){var D=this.grid.rowCount-1,C=this.grid.layout.cellCount-1,B=this.rowIndex,H=this.cell.index,E=Math.min(D,Math.max(0,B+I)),G=Math.min(C,Math.max(0,H+F));
this.setFocusIndex(E,G);
if(I){this.grid.updateRow(B)
}},previousKey:function(B){if(this.isFirstFocusCell()){this.tabOut(this.grid.domNode)
}else{A.stopEvent(B);
this.previous()
}},nextKey:function(B){if(this.isLastFocusCell()){this.tabOut(this.grid.lastFocusNode)
}else{A.stopEvent(B);
this.next()
}},tabOut:function(B){this.tabbingOut=true;
B.focus()
},focusGrid:function(){dojox.grid.fire(this.focusView,"focus");
this._focusifyCellNode(true)
},doFocus:function(B){if(B&&B.target!=B.currentTarget){return 
}if(!this.tabbingOut&&this.isNoFocusCell()){this.setFocusIndex(0,0)
}this.tabbingOut=false
}})
}}});